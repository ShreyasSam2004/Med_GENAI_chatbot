<!DOCTYPE html>
<html>
<head>
	<title>Medical Chatbot</title>

	<!-- Bootstrap & Icons -->
	<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet">
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css">

	<!-- Your CSS -->
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
<div class="container-fluid h-100">
	<div class="row justify-content-center h-100">
		<div class="col-md-8 col-xl-6 chat">
			<div class="card">

				<!-- HEADER -->
				<div class="card-header msg_head">
					<div class="d-flex bd-highlight">
						<div class="img_cont">
							<img src="https://cdn-icons-png.flaticon.com/512/387/387569.png"
								 class="rounded-circle user_img">
							<span class="online_icon"></span>
						</div>

						<div class="user_info">
							<span>Medical Chatbot</span>
							<p>Ask me anything!</p>
						</div>
					</div>

					<!-- Dark mode toggle -->
					<div class="dark-toggle" id="toggleTheme">
						<i class="fas fa-moon"></i>
					</div>
				</div>

				<!-- BODY -->
				<div id="messageFormeight" class="card-body msg_card_body"></div>

				<!-- Typing Indicator -->
				<div id="typing" class="typing-indicator">
					Medical Assistant is typingâ€¦
				</div>

				<!-- FOOTER -->
				<div class="card-footer">
					<form id="messageArea" class="input-group">
						<input type="text"
							   id="text"
							   name="msg"
							   placeholder="Type your message..."
							   autocomplete="off"
							   class="form-control type_msg"
							   required />

						<div class="input-group-append">
							<button type="submit" id="send" class="input-group-text send_btn">
								<i class="fas fa-location-arrow"></i>
							</button>
						</div>
					</form>

					<!-- Disclaimer -->
					<div class="disclaimer">
						This chatbot is not a replacement for a doctor.
					</div>
				</div>

			</div>
		</div>
	</div>
</div>

<!-- SCRIPT -->
<script>
$(document).ready(function() {

	// Dark mode toggle
	$("#toggleTheme").click(function() {
	$("html").toggleClass("light-mode");

	const icon = $("#toggleTheme i");
	if ($("html").hasClass("light-mode")) {
		icon.removeClass("fa-moon").addClass("fa-sun");
	} else {
		icon.removeClass("fa-sun").addClass("fa-moon");
	}
});

	$("#messageArea").on("submit", function(event) {
		event.preventDefault();

		const date = new Date();
		const str_time = date.getHours() + ":" + date.getMinutes();
		const rawText = $("#text").val();

		if (!rawText.trim()) return;

		// User message
		const userHtml = `
		<div class="d-flex justify-content-end mb-4">
			<div class="msg_cotainer_send">
				${rawText}
				<span class="msg_time_send">${str_time}</span>
			</div>
			<div class="img_cont_msg">
				<img src="https://i.ibb.co/d5b84Xw/Untitled-design.png"
					 class="rounded-circle user_img_msg">
			</div>
		</div>`;

		$("#text").val("");
		$("#messageFormeight").append(userHtml);
		$(".msg_card_body").scrollTop($(".msg_card_body")[0].scrollHeight);

		// Show typing indicator
		$("#typing").fadeIn();

		$.ajax({
			data: { msg: rawText },
			type: "POST",
			url: "/get"
		}).done(function(data) {

			// Hide typing indicator
			$("#typing").fadeOut();

			const botHtml = `
			<div class="d-flex justify-content-start mb-4">
				<div class="img_cont_msg">
					<img src="https://cdn-icons-png.flaticon.com/512/387/387569.png"
						 class="rounded-circle user_img_msg">
				</div>
				<div class="msg_cotainer">
					${data}
					<div class="source-badge">ðŸ“š Source: Medical PDF</div>
					<span class="msg_time">${str_time}</span>
				</div>
			</div>`;

			$("#messageFormeight").append(botHtml);
			$(".msg_card_body").scrollTop($(".msg_card_body")[0].scrollHeight);
		});
	});
});
</script>

</body>
</html>
